## **AEM QA 시스템: 기술 백서 및 아키텍처 가이드**

**문서 버전: 1.0**
**최종 업데이트: 2025년 8월 13일**

### **1. 시스템 비전 및 목표**

**비전:** AEM(Adobe Experience Manager) 다국어 콘텐츠의 품질 보증(QA) 프로세스를 자동화하고, AI를 통해 번역의 일관성과 품질을 극대화하여 인간 작업자의 창의적인 업무에 집중할 수 있는 환경을 제공한다.

**핵심 목표:**

  * **자동화:** AEM 페이지 및 자산의 변경사항을 자동으로 감지하고 추적한다.
  * **지능화:** 기존 번역 자산을 AI로 학습하여, 새로운 번역 작업에 대한 최적의 추천을 제공한다.
  * **체계화:** 모든 QA 과정을 데이터 기반으로 전환하여, 객관적인 리포팅과 효율적인 워크플로우를 구축한다.

---  
#### AEM QA 자동화 기반 업무 플로우 (figure 1)
``` mermaid
graph LR
    subgraph "INPUT: 비즈니스 문제"
        AEM["`**AEM Server**<br/>(복잡하고, 비효율적인<br/>다국어 콘텐츠 소스)`"]
    end

    subgraph "SOLUTION: AI 기반 자동화 파이프라인"
        style B fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
        style C fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
        style D fill:#fce4ec,stroke:#880e4f,stroke-width:2px
        style E fill:#e1f5fe,stroke:#01579b,stroke-width:2px

        B["`**Step 1: 자동화된 데이터 수집**<br/>(Automated Data Collection)<br/><br/>AEM의 모든 변경사항(페이지, PDF)을<br/>24/7 자동으로 수집 및 패키징`"]
        C["`**Step 2: AI 데이터 정제 및 지능화**<br/>(AI-Powered Enrichment)<br/><br/>수집된 데이터의 노이즈를 제거하고,<br/>AI가 이해할 수 있는<br/>'번역 메모리(TM)'로 재가공`"]
        D["`**Step 3: 지능형 데이터 저장소**<br/>(Intelligent Data Storage)<br/><br/>- **MongoDB:** 구조화된 콘텐츠 저장<br/>- **ChromaDB:** AI 검색을 위한 벡터 데이터 저장`"]
        E["`**Step 4: QA 워크스테이션**<br/>(User-Facing QA Station)<br/><br/>분석된 데이터를 시각화하고,<br/>사용자에게 AI 기반의<br/>인사이트와 번역 추천 제공`"]
    end

    subgraph "OUTPUT: 비즈니스 가치"
        F["`**사용자 (QA팀, 번역가)**<br/><br/>- **생산성 50% 향상**<br/>- **번역 품질 일관성 확보**<br/>- **데이터 기반 의사결정**`"]
    end

    %% Data Flow
    AEM --> B
    B --> C
    C --> D
    D --> E
    E --> F
```

-----

#### AEM 현지화 QA 자동화 작전 지도 (Figure 2)
``` mermaid
graph TD
    subgraph "Business & Content Operations Team (비즈니스 및 콘텐츠 운영팀)"
        style B_Ops fill:#fff3e0,stroke:#e65100,stroke-width:2px
        B1["`**1. Business Event: AEM Page Update**<br/>(AEM 페이지 업데이트 발생)<br/><br/>마케터 또는 콘텐츠 관리자가<br/>AEM에서 원본(EN) 페이지 수정`"]
        B2["`**2. QA Task Triggered**<br/>(QA 업무 발생)<br/><br/>- 변경된 페이지 목록 CSV 파일 생성<br/>- 번역 및 검수 작업 요청`"]
        B3["`**6. Value Realization**<br/>(가치 실현)<br/><br/>- **품질 향상:** 일관되고 정확한 번역<br/>- **시간 단축:** 수동 검토 시간 50% 이상 절감<br/>- **데이터 기반 개선:** 리포트를 통한 프로세스 최적화`"]
    end

    subgraph "Data Intelligence Pipeline Team (백엔드 & 데이터 팀)"
        style T_Ops fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
        T1["`**3. Automated Data Ingestion**<br/>(데이터 자동 수집 및 처리)<br/><br/>**aem-qa-system**<br/>- **collectors:** 변경된 AEM 버전 자동 수집<br/>- **processors/data_ingestor:** 컴포넌트 단위로 분해 및<br/>MongoDB에 버전별로 저장`"]
        T2["**4. AI-Powered Enrichment**<br/>(AI 기반 데이터 지능화)<br/><br/>**aem-qa-system**<br/>- **processors/tm_builder:** 원본/번역본 구조 비교로 TM 생성<br/>- **processors/tm_cleaner:** HTML 등 노이즈 제거<br/>- **processors/semantic_segmenter:** AI로 의미 단위 분할<br/>- **indexing/chroma_indexer:** AI 검색용 벡터 인덱스 생성`"]
    end

    subgraph "QA & Product Team (프론트엔드 & QA팀)"
        style P_Ops fill:#e1f5fe,stroke:#01579b,stroke-width:2px
        P1["**5. Intelligent QA Workbench**<br/>(지능형 QA 워크스테이션)<br/><br/>**`aem-qa-station`**<br/>- **app.py:** 사용자가 CSV 업로드<br/>- **modules/analyzer:** 두 버전 간 변경사항 실시간 분석 및 시각화<br/>- **modules/searcher:** 변경된 텍스트에 대해 ChromaDB에<br/>유사 번역 사례 AI 검색 및 추천`"]
    end
    
    subgraph "💾 Core Data Assets (데이터 자산)"
        style D_Assets fill:#fce4ec,stroke:#880e4f,stroke-width:1.5px,stroke-dasharray: 5 5
        MongoDB["`**MongoDB**<br/>(구조화된 진실의 원천)`"]
        ChromaDB["`**ChromaDB**<br/>(AI의 기억 저장소)`"]
    end

    %% --- Workflow Connections ---
    B1 --> B2
    B2 -- QA Task List --> P1

    AEM -- Raw Data --> T1
    T1 -- Structured Component Data --> MongoDB
    
    MongoDB -- Reads Components --> T2
    T2 -- Writes Enriched TM & Vectors --> MongoDB
    T2 -- Writes Enriched TM & Vectors --> ChromaDB

    P1 -- Analyzes Changes via --> MongoDB
    P1 -- Gets AI Recommendations via --> ChromaDB
    P1 -- Delivers Insights & Tools to --> B3

    classDef business fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef tech fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef product fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    class B1,B2,B3 business
    class T1,T2 tech
    class P1 product
```

### **2. 시스템 아키텍처 개요**

본 시스템은 크게 \*\*백엔드 데이터 파이프라인(`aem-qa-system`)\*\*과 \*\*프론트엔드 워크스테이션(`aem-qa-station`)\*\*이라는 두 개의 독립적인 애플리케이션으로 구성되며, 이 둘은 MongoDB와 ChromaDB를 통해 데이터를 공유하는 \*\*분리형 아키텍처(Decoupled Architecture)\*\*를 채택하고 있습니다.

| 계층 (Layer) | 주요 기술 | 핵심 역할 |
| :--- | :--- | :--- |
| **Data Collection** | Python, `requests`, `PyMuPDF` | AEM 서버 및 외부 소스에서 원시 데이터(JSON, PDF, Excel) 수집 |
| **Data Processing** | Python, Pandas | 수집된 데이터를 정제, 가공하여 분석 가능한 형태로 변환 (TM 구축) |
| **Storage** | MongoDB, ChromaDB, File System | 가공된 데이터와 AI 모델을 위한 벡터 인덱스를 영구 저장 |
| **AI / ML** | `sentence-transformers`, `ollama` | 텍스트를 벡터로 변환하고, 의미 기반 검색 및 분석 수행 |
| **Presentation (UI)** | Streamlit | 분석된 데이터를 사용자에게 시각적으로 제공하는 웹 애플리케이션 |
| **Orchestration** | Jupyter Notebooks | 전체 백엔드 데이터 파이프라인의 흐름을 단계별로 실행 및 관리 |

-----

### **3. 핵심 부품(Component) 상세 설명**

#### **3.0 시스템 다이어그램** (Figure 3)
``` mermaid
graph TD
    subgraph "🌐 External Sources & User"
        AEM_Server["`**AEM Server**<br/>(Content Source)`"]
        User["`**User / Browser**<br/>(QA Manager, Translator)`"]
    end

    subgraph "⚙️ aem-qa-system (Backend Data Pipeline)"
        
        subgraph "1. Data Collection Layer"
            A_Collector["`**aem_collector.py**<br/>- Fetches AEM page snapshots (JSON)<br/>- Multi-threaded downloads`"]
            P_Collector["`**pdf_collector.py**<br/>- Downloads PDF assets`"]
            U_Excel["`**utils/excel_processor.py**<br/>- Processes initial TM/Glossary Excels`"]
            U_Batch["`**utils/batch_utils.py**<br/>- Splits large lists into small batches`"]
            M_Builder["`**collectors/manifest_builder.py**<br/>- Creates file inventory`"]
            P_Builder["`**collectors/package_builder.py**<br/>- Creates data package (ZIP)`"]
        end

        subgraph "2. Data Processing Layer"
            D_Ingestor["`**processors/data_ingestor.py**<br/>- Unzips package<br/>- Deconstructs JSON<br/>- Hashes components for versioning<br/>- Writes to MongoDB`"]
            TM_Builder["`**processors/aem_tm_builder.py**<br/>- Reads MongoDB<br/>- Compares page structures<br/>- Builds raw Translation Memory (TM)`"]
            TM_Cleaner["`**processors/tm_cleaner.py**<br/>- Removes HTML/JCR noise from raw TM<br/>- Creates 'Clean TM'`"]
            S_Segmenter["`**processors/semantic_segmenter.py**<br/>- Splits long texts in 'Clean TM'<br/>- Semantic segmentation using AI`"]
        end

        subgraph "3. Analysis & AI Indexing Layer"
            S_Analyzer["`**analyzers/page_structure_analyzer.py**<br/>- Analyzes structural differences<br/>- Generates mismatch reports`"]
            C_Indexer["`**indexing/chroma_indexer.py**<br/>- Reads 'Clean TM' from MongoDB<br/>- Encodes text to vectors<br/>- Writes vectors to ChromaDB`"]
        end

    end

    subgraph "🖥️ aem-qa-station (Frontend Workstation)"
        App["`**app.py**<br/>(Main Streamlit App)<br/>- Manages UI & overall workflow`"]
        
        subgraph "UI Modules"
            Connections["`**modules/connections.py**<br/>- Manages cached connections to DBs`"]
            V_Manager["`**modules/version_manager.py**<br/>- Fetches version info from MongoDB<br/>- Provides version selection UI`"]
            S_Analyzer_UI["`**modules/analyzer.py**<br/>- Compares selected versions from MongoDB<br/>- Provides real-time change data to App`"]
            Searcher["`**modules/searcher.py**<br/>- Takes text from App<br/>- Queries ChromaDB for similar translations<br/>- Returns AI recommendations`"]
        end
    end

    subgraph "💾 Storage Layer"
        MongoDB["`**MongoDB**<br/>- page_components<br/>- translation_memory_*<br/>- clean_translation_memory_*`"]
        ChromaDB["`**ChromaDB**<br/>(Vector Store)<br/>- tm_en_ko<br/>- tm_en_ja`"]
    end

    %% --- Data Flow Connections ---

    %% Collection Flow
    AEM_Server --> A_Collector
    AEM_Server --> P_Collector
    U_Batch --> A_Collector
    U_Batch --> P_Collector
    A_Collector --> M_Builder
    P_Collector --> M_Builder
    U_Excel --> P_Builder
    M_Builder --> P_Builder

    %% Processing Flow
    P_Builder --> D_Ingestor
    D_Ingestor --> MongoDB
    MongoDB -- reads components --> TM_Builder
    TM_Builder -- writes raw TM --> MongoDB
    MongoDB -- reads raw TM --> TM_Cleaner
    TM_Cleaner -- writes clean TM --> MongoDB
    MongoDB -- reads clean TM --> S_Segmenter
    S_Segmenter -- writes segmented TM --> MongoDB

    %% Analysis & Indexing Flow
    MongoDB -- reads components --> S_Analyzer
    MongoDB -- reads clean/segmented TM --> C_Indexer
    C_Indexer --> ChromaDB

    %% Frontend Flow
    User -- interacts with --> App
    App -- uses --> Connections
    App -- uses --> V_Manager
    App -- uses --> S_Analyzer_UI
    App -- uses --> Searcher

    Connections --> MongoDB
    Connections --> ChromaDB
    V_Manager -- queries versions --> MongoDB
    S_Analyzer_UI -- queries components --> MongoDB
    Searcher -- queries vectors --> ChromaDB

    %% Style Definitions
    classDef backend fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef frontend fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef storage fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef external fill:#fff3e0,stroke:#e65100,stroke-width:2px

    class A_Collector,P_Collector,U_Excel,U_Batch,M_Builder,P_Builder,D_Ingestor,TM_Builder,TM_Cleaner,S_Segmenter,S_Analyzer,C_Indexer backend
    class App,Connections,V_Manager,S_Analyzer_UI,Searcher frontend
    class MongoDB,ChromaDB storage
    class AEM_Server,User external
```

#### **3.1. 백엔드: `aem-qa-system`**

##### **`src/collectors` - 데이터 수집기**

  * **`aem_collector.py`**: AEM 서버에 직접 연결하여, 다중 버전(e.g., `lm-en`, `spac-ko_KR`) 및 다중 언어 페이지의 JSON 스냅샷을 멀티스레딩으로 수집합니다.
  * **`pdf_collector.py`**: AEM에 링크된 다국어 PDF 파일을 수집합니다.
  * **`package_builder.py`**: 수집된 모든 파일과 메타데이터(`manifest.json`)를 하나의 ZIP 패키지로 압축하여 데이터 처리 단계로 전달합니다.

##### **`src/processors` - 데이터 처리기 (시스템의 심장)**

  * **`data_ingestor.py`**: ZIP 패키지를 받아, AEM JSON 스냅샷을 컴포넌트 단위로 분해하고, 각 컴포넌트의 변경 여부를 추적하기 위해 \*\*콘텐츠 해시(Hash)\*\*를 생성하여 MongoDB에 저장합니다. 이것이 시스템의 **버전 관리** 핵심입니다.
  * **`aem_tm_builder.py`**: MongoDB에 저장된 컴포넌트 데이터를 기반으로, 원본과 번역본 페이지의 구조를 비교하여 \*\*번역 메모리(Translation Memory, TM)\*\*를 구축합니다.
  * **`tm_cleaner.py` & `utlimate_tm_builder.py`**: 생성된 TM에서 불필요한 HTML 태그나 JCR 속성 같은 노이즈를 제거하여, 순수한 텍스트만 남은 \*\*'Clean TM'\*\*과 HTML을 따로 보관하는 \*\*'HTML Archive'\*\*로 분리합니다.
  * **`semantic_segmenter.py`**: **가장 진보된 부품 중 하나**로, 'Clean TM'의 긴 문장을 AI 임베딩 모델을 사용하여 의미적으로 가장 적절한 단위로 자동 분할하여 AI 검색의 정확도를 극대화합니다.

##### **`src/indexing` & `src/analyzers` - 분석 및 AI 준비**

  * **`chroma_indexer.py`**: 정제되고 분할된 'Clean TM'을 `sentence-transformers` 모델을 이용해 벡터로 변환하고, ChromaDB에 저장하여 의미 기반 검색이 가능하도록 **AI 인덱스**를 생성합니다.
  * **`page_structure_analyzer.py`**: 번역이 누락된 페이지의 원본/번역본 구조 차이를 분석하여, 어떤 컴포넌트가 누락되었는지 리포트를 생성합니다.

#### **3.2. 프론트엔드: `aem-qa-station`**

##### **`app.py` - 메인 애플리케이션**

  * Streamlit을 사용하여 전체 UI를 구성합니다. 사용자가 CSV로 검수할 페이지 목록을 업로드하면, 백엔드 데이터를 활용하여 대시보드와 상세 분석 화면을 동적으로 생성하는 역할을 합니다.

##### **`modules/` - 핵심 기능 모듈**

  * **`connections.py`**: MongoDB와 ChromaDB에 대한 연결을 관리합니다. Streamlit의 캐시 기능을 활용하여 불필요한 연결 반복을 방지하고 성능을 최적화합니다.
  * **`version_manager.py`**: MongoDB에 저장된 모든 AEM 페이지 버전을 조회하고, 사용자가 비교하고 싶은 특정 버전을 선택할 수 있는 UI를 제공합니다.
  * **`analyzer.py`**: 사용자가 선택한 두 버전의 페이지 데이터를 MongoDB에서 가져와, 컴포넌트 단위로 무엇이 추가/수정/삭제되었는지 실시간으로 분석하고 그 결과를 `app.py`에 전달합니다.
  * **`searcher.py`**: **AI 추천 기능의 핵심**입니다. 사용자가 보고 있는 변경된 텍스트를 ChromaDB의 AI 인덱스에 쿼리하여, 의미적으로 가장 유사한 기존 번역 사례를 찾아와 `app.py`에 추천 결과로 전달합니다.

-----

이제 이 '지도'를 가지고, 우리는 시스템의 어느 부분이든 자신 있게 탐험하고 개선해나갈 수 있습니다. 다음 기능 개선을 위한 완벽한 준비가 끝났습니다.